# Markdown to DOCX (ГОСТ) / Шаблон Pandoc

Готовое решение для автоматической конвертации текста в формате Markdown(особенно сгенерированного LLM) в формат DOCX с соблюдением требований ГОСТ.

Проект оптимизирован для работы с текстами, сгенерированными LLM, исправляя типичные артефакты форматирования нейросетей.

## Возможности

*   **Оформление по ГОСТ:** Шрифт Times New Roman 14pt, полуторный интервал, отступ первой строки 1.25 см, корректные поля.
*   **Автоматическая нумерация:** Рисунки, таблицы и формулы нумеруются автоматически (в том числе по главам, например: *Рис. 1.2*, *Таблица 2.1*).
*   **Перекрестные ссылки:** Работающие ссылки в тексте («см. рис. 1.2») — при изменении порядка объектов ссылки обновляются сами.
*   **Чистка мусора:** Фильтр удаляет горизонтальные разделители (`---`), которые часто генерируют нейросети, предотвращая пустые страницы в Word.
*   **Оглавление:** Автоматическая генерация содержания с номерами страниц.

## Структура репозитория

*   `reference.docx` — Шаблон стилей Word (настроенные шрифты, отступы, границы таблиц).
*   `crossref_config.yaml` — Конфигурация локализации (русские подписи: "Рис.", "Табл.", "Ур.").
*   `no-line.lua` — Скрипт очистки артефактов форматирования.
*   `images/` — Папка, в которую необходимо складывать все изображения для документа.

## Требования

Для работы необходимо:

1.  **Pandoc** (версия 2.11 и выше).
2.  **Pandoc-crossref** (фильтр для ссылок, версия должна совпадать с Pandoc).
3.  **Microsoft Word** (2010 и новее) или совместимый редактор.

### Установка инструментов

**macOS (Homebrew):**
```bash
brew install pandoc pandoc-crossref
```

**Windows / Linux:**
Скачайте актуальные версии с GitHub: [Pandoc](https://github.com/jgm/pandoc/releases), [Pandoc-crossref](https://github.com/lierdakil/pandoc-crossref/releases).

## Использование (Workflow)

### 1. Подготовка файлов
*   Сохраните ваш текст в формате Markdown в корень папки (например, `work.md`).
*   Все изображения положите в папку `images/`.

### 2. Запуск конвертации
Откройте терминал в папке проекта и выполните команду:

```bash
pandoc work.md \
  -o output.docx \
  --reference-doc=reference.docx \
  --filter pandoc-crossref \
  --lua-filter=no-line.lua \
  --metadata-file=crossref_config.yaml \
  --toc
```

**Разбор параметров:**
*   `work.md` — ваш исходный файл.
*   `-o output.docx` — имя готового документа.
*   `--toc` — генерирует оглавление. **Важно:** Pandoc всегда вставляет оглавление в самое начало документа.

### 3. Нюансы с Титульным листом и Оглавлением
Поскольку Pandoc вставляет оглавление первой страницей, **Титульный лист** лучше не писать в Markdown, а создать в отдельном docx файле и скопировать.

## Промпт для LLM

Чтобы сразу получить корректный Markdown (с правильными списками, путями и ссылками), используйте этот промпт:

> Текст пиши в формате Markdown для конвертации через Pandoc.
>
> 1.  **Структура:** Используй заголовки `#` (для глав) и `##` (для подглав). Не используй горизонтальные линии `---`.
> 2.  **Списки:** ОБЯЗАТЕЛЬНО оставляй пустую строку перед началом ЛЮБОГО списка (маркированного, нумерованного и т.д.), иначе он сольется в единый текст после конвертации в docx.
> 3.  **Формулы:** Пиши в LaTeX-формате: `$$...$$`. Обязательно отбивай формулу пустыми строками сверху и снизу. Если формула важная, добавь ей метку: `$$ E=mc^2 $$ {#eq:energy}`.
> 4.  **Картинки:** Все пути к изображениям должны начинаться с папки `images/`. Оформляй так: `![Подпись к рисунку](images/filename.png){#fig:short_name}`.
> 5.  **Таблицы:** Подпись пиши ПЕРЕД таблицей в формате: `: Подпись таблицы {#tbl:stats}`. Делай разделители в таблице длинными, чтобы колонка была широкой (пример: `| :------- |`).
> 6.  **Ссылки:** В тексте ссылайся на рисунки, таблицы и формулы через собачку: "см. @fig:short_name", "в @tbl:stats", "согласно @eq:energy".
> 7.  Не генерируй Титульный лист и "Содержание", начни сразу с Введения.

## Лицензия
MIT License.